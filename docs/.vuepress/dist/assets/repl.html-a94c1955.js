import{d as k,r as z,_,b as R,o as g,c as b,e as p,f as v,F as A,g as E,n as C,t as D,h as M,w as N,v as q,i as x,j as B,k as V}from"./app-237bf93c.js";const $={0:"ansi-reset",1:"ansi-bright",2:"ansi-dim",4:"ansi-underscore",5:"ansi-blink",7:"ansi-reverse",8:"ansi-hidden",30:"ansi-black",31:"ansi-red",32:"ansi-green",33:"ansi-yellow",34:"ansi-blue",35:"ansi-magenta",36:"ansi-cyan",37:"ansi-white",40:"ansi-onblack",41:"ansi-onred",42:"ansi-ongreen",43:"ansi-onyellow",44:"ansi-onblue",45:"ansi-onmagenta",46:"ansi-oncyan",47:"ansi-onwhite",90:"ansi-bright ansi-black",91:"ansi-bright ansi-red",92:"ansi-bright ansi-green",93:"ansi-bright ansi-yellow",94:"ansi-bright ansi-blue",95:"ansi-bright ansi-magenta",96:"ansi-bright ansi-cyan",97:"ansi-bright ansi-white"};let c=z([]);const F=k({data:()=>({wasmImports:null,ctx:null,stdin:null,replHistory:[],historyIndex:0}),computed:{stdout:function(){return c}},methods:{run(e){var n;if(!e.shiftKey&&((n=this.stdin)==null?void 0:n.length)>0){const t=document.querySelector("#stdin");(this.replHistory.length==0||this.replHistory[this.replHistory.length-1]!==t.value)&&(this.replHistory.push(t.value),this.replHistory=this.replHistory.slice(-100),this.historyIndex=this.replHistory.length,localStorage.setItem("replHistory",JSON.stringify(this.replHistory))),c.value.push({type:"input",content:`
> ${t.value}
`}),this.wasmImports.runLine(this.ctx),setTimeout(function(){const l=document.querySelector("#stdout");l.scrollTop=l.scrollHeight},100),this.stdin=null}},historyUp(){this.replHistory.length!=0&&(this.historyIndex=Math.max(0,this.historyIndex-1),this.stdin=this.replHistory[this.historyIndex],this.setCursorAtEnd())},historyDown(){this.replHistory.length!=0&&(this.historyIndex=Math.min(this.historyIndex+1,this.replHistory.length),this.stdin=this.replHistory[this.historyIndex],this.setCursorAtEnd())},setCursorAtEnd(){const e=document.querySelector("#stdin");setTimeout(function(){e.selectionStart=e.selectionEnd=e.value.length},0)},clear(){c.value=[]},ansiToHtml(e){let n=[],t=null,l=null;for(const u of e.matchAll(/\033\[([0-9]+)m/g))t===null&&u.index>0?(t=0,n.push({content:e.slice(0,u.index)})):u.index>0&&l!==null&&(l.content=e.slice(t,u.index),n.push(l)),t=u.index+u[0].length,l={class:$[u[1]]};return t!==null&&t<e.length&&l!==null?l.content=e.slice(t):t===null&&n.push({content:e}),n}},async mounted(){const e=new TextDecoder,n=new TextEncoder;var t=new WebAssembly.Memory({initial:100,maximum:1e3});function l(a,r){let i=e.decode(new Uint8Array(t.buffer,a,r),{stream:!0});const o=c.value.length>0?c.value[c.value.length-1].type:null;o===null||o==="input"?c.value.push({type:"output",content:i}):c.value[c.value.length-1].content+=i}function u(a,r){const i=document.querySelector("#stdin");let o=i.value;return new Uint8Array(t.buffer,a,r).set(n.encode(o).slice(0,r)),i.value="",Math.min(r,o.length)}function S(a,r,i,o,h,y){const m=e.decode(new Uint8Array(t.buffer,a,r),{stream:!0}),d=e.decode(new Uint8Array(t.buffer,i,o),{stream:!0}),f=e.decode(new Uint8Array(t.buffer,h,y),{stream:!0});return n.encode(m.replace(new RegExp(f),d)).length}function H(a,r,i,o,h,y,m,d){const f=e.decode(new Uint8Array(t.buffer,a,r),{stream:!0}),U=e.decode(new Uint8Array(t.buffer,i,o),{stream:!0}),I=e.decode(new Uint8Array(t.buffer,h,y),{stream:!0});new Uint8Array(t.buffer,m,d).set(n.encode(f.replace(new RegExp(I),U)).slice(0,d))}function s(a,r,i,o,h,y){const m=e.decode(new Uint8Array(t.buffer,a,r),{stream:!0}),d=e.decode(new Uint8Array(t.buffer,i,o),{stream:!0}),f=e.decode(new Uint8Array(t.buffer,h,y),{stream:!0});return n.encode(m.replaceAll(new RegExp(f,"g"),d)).length}function w(a,r,i,o,h,y,m,d){const f=e.decode(new Uint8Array(t.buffer,a,r),{stream:!0}),U=e.decode(new Uint8Array(t.buffer,i,o),{stream:!0}),I=e.decode(new Uint8Array(t.buffer,h,y),{stream:!0});new Uint8Array(t.buffer,m,d).set(n.encode(f.replaceAll(new RegExp(I,"g"),U)).slice(0,d))}this.wasmImports=(await WebAssembly.instantiateStreaming(fetch("buzz.wasm"),{env:{memory:t,writeToStderr:l,readFromStdin:u,patternReplace:H,patternReplaceLength:S,patternReplaceAllLength:s,patternReplaceAll:w}})).instance.exports,c.value=[],this.ctx=this.wasmImports.initRepl(),document.querySelector("#stdin").focus(),this.replHistory=JSON.parse(localStorage.getItem("replHistory")??"[]").slice(-100),this.historyIndex=this.replHistory.length}});const K={class:"language-buzz"},J={id:"stdout"},L={class:"stdin-container"},O=p("span",{id:"prompt"},"Â»",-1),W={href:"https://github.com/buzz-language/buzz/issues",target:"_blank",rel:"noopener noreferrer"};function j(e,n,t,l,u,S){const H=R("ExternalLinkIcon");return g(),b("div",null,[p("div",K,[p("pre",J,[v("        "),(g(!0),b(A,null,E(e.stdout.value,s=>(g(),b(A,null,[(g(!0),b(A,null,E(e.ansiToHtml(s.content),w=>(g(),b(A,null,[w.content.length>0?(g(),b("code",{key:0,class:C(w.class??"")},D(w.content),3)):M("v-if",!0)],64))),256))],64))),256)),v(`
    `)]),p("div",L,[O,N(p("input",{onKeydown:[n[0]||(n[0]=x((...s)=>e.run&&e.run(...s),["enter"])),n[1]||(n[1]=x((...s)=>e.historyUp&&e.historyUp(...s),["up"])),n[2]||(n[2]=x((...s)=>e.historyDown&&e.historyDown(...s),["down"])),n[3]||(n[3]=x(B((...s)=>e.clear&&e.clear(...s),["ctrl"]),["l"]))],id:"stdin","onUpdate:modelValue":n[4]||(n[4]=s=>e.stdin=s),rows:"1",autocomplete:"off",placeholder:"Type buzz code here..."},null,544),[[q,e.stdin]])])]),p("p",null,[p("em",null,[v("Please "),p("a",W,[v("report"),V(H)]),v(" any bug or unexpected behaviour")])])])}const Q=_(F,[["render",j],["__file","repl.html.vue"]]);export{Q as default};
